id: git_python_with_secret
namespace: company.team

tasks:
  - id: py
    type: io.kestra.plugin.core.flow.WorkingDirectory
    tasks:
      - id: clone_repository
        type: io.kestra.plugin.git.Clone
        url: https://github.com/anna-geller/kestra-flows
        branch: main
        username: anna-geller
        password: "{{ secret('GITHUB_ACCESS_TOKEN') }}"

    - id: py_bash
      type: io.kestra.core.tasks.scripts.Python
      beforeCommands:
        - pip install requests pandas
      commands:
        - ./bin/python examples/scripts/etl_script.py
