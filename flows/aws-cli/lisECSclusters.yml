id: lisECSclusters
namespace: dev

tasks:
  - id: wdir
    type: io.kestra.core.tasks.flows.WorkingDirectory
    description: both commands do the same but the first one queries the relevant info directly using `--query` while the other stores the result to JSON, making it available for further processing or download
    tasks:
    - id: aws
      type: io.kestra.plugin.aws.cli.AwsCLI
      accessKeyId: "{{secret('AWS_ACCESS_KEY_ID')}}"
      secretKeyId: "{{secret('AWS_SECRET_ACCESS_KEY')}}"
      region: "eu-central-1"
      commands:
        - aws ecs list-clusters --query 'clusterArns[*]'
        - aws ecs list-clusters > output.json
      docker:
        image: amazon/aws-cli
        entryPoint:
          - ''
        pullPolicy: ALWAYS
    - id: json
      type: io.kestra.core.tasks.storages.LocalFiles
      outputs:
        - "*.json"