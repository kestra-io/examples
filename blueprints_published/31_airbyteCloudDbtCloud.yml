# id: 31
# https://demo.kestra.io/ui/blueprints/community/31
# http://localhost:8080/ui/blueprints/31
# Trigger multiple Airbyte Cloud syncs, then run a dbt Cloud job
# Tags: Parallel, Ingest, dbt
description: |
  This flow will sync data from multiple sources in parallel using Airbyte Cloud. Then, it will run a dbt Cloud job.
  
  It's recommended to configure the Dbt Cloud and [Airbyte API](https://portal.airbyte.com/apiKeys) tokens as secrets.

id: 31_airbyteCloudDbtCloud
namespace: blueprint

tasks:
  - id: data-ingestion
    type: io.kestra.core.tasks.flows.Parallel
    tasks:
      - id: salesforce
        type: io.kestra.plugin.airbyte.cloud.jobs.Sync
        connectionId: e3b1ce92-547c-436f-b1e8-23b6936c12ab
      - id: google-analytics
        type: io.kestra.plugin.airbyte.cloud.jobs.Sync
        connectionId: e3b1ce92-547c-436f-b1e8-23b6936c12cd
      - id: facebook-ads
        type: io.kestra.plugin.airbyte.cloud.jobs.Sync
        connectionId: e3b1ce92-547c-436f-b1e8-23b6936c12ef

  - id: dbt-cloud-job
    type: io.kestra.plugin.dbt.cloud.TriggerRun
    jobId: "396284"
    accountId: "{{ secret('DBT_CLOUD_ACCOUNT_ID') }}"
    token: "{{ secret('DBT_CLOUD_API_TOKEN') }}"
    wait: true

taskDefaults:
  - type: io.kestra.plugin.airbyte.cloud.jobs.Sync
    values:
      token: "{{ secret('AIRBYTE_CLOUD_API_TOKEN') }}"